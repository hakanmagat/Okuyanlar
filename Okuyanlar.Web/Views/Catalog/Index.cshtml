@model Okuyanlar.Web.Models.CatalogIndexViewModel
@{
    ViewData["Title"] = "Catalog";
}

<div class="ok-container ok-section">
    <div class="ok-pagehead">
        <div>
            <h2 class="ok-pagehead-title">Catalog</h2>
            <div class="ok-pagehead-sub">Search, filter, and explore books.</div>
        </div>

        <div class="ok-pagehead-actions">
            <a class="btn-ok-secondary" asp-controller="Books" asp-action="Top10">
                <i class="bi bi-trophy me-2"></i>Top 10
            </a>
        </div>
    </div>

    <div class="ok-catalog-toolbar ok-card ok-mt-3">
        <div class="ok-card-body">
            <form method="get" class="ok-toolbar-grid">
                <div class="ok-toolbar-item">
                    <label class="ok-form-label">Search</label>
                    <div class="ok-input-group">
                        <span class="ok-input-group-text"><i class="bi bi-search"></i></span>
                        <input name="q" value="@Model.Query" class="ok-form-control" placeholder="Book title, author..." />
                    </div>
                </div>

                <div class="ok-toolbar-item">
                    <label class="ok-form-label">Category</label>
                    <select name="category" class="ok-form-control">
                        <option value="">All</option>
                        @foreach (var c in Model.Categories)
                        {
                            <option value="@c" selected="@(Model.Category == c)">@c</option>
                        }
                    </select>
                </div>

                <div class="ok-toolbar-item">
                    <label class="ok-form-label">Sort</label>
                    <select name="sort" class="ok-form-control">
                        <option value="title" selected="@(Model.Sort == "title")">A-Z</option>
                        <option value="new" selected="@(Model.Sort == "new")">Newest</option>
                        <option value="rating" selected="@(Model.Sort == "rating")">Rating</option>
                    </select>
                </div>

                <div class="ok-toolbar-item ok-toolbar-cta">
                    <button class="btn-ok-primary w-100" type="submit">
                        Apply Filters
                    </button>
                </div>
            </form>
        </div>
    </div>

    @if (Model.Items == null || Model.Items.Count == 0)
    {
        <div class="ok-empty ok-mt-4">
            <div class="ok-empty-icon"><i class="bi bi-journal-x"></i></div>
            <div class="ok-empty-title">No results found</div>
            <div class="ok-empty-sub">Try a different search term or clear filters.</div>
            <a class="btn-ok-secondary ok-mt-2" asp-controller="Catalog" asp-action="Index">Reset filters</a>
        </div>
    }
    else
    {
        <div class="ok-mt-4">
            @foreach (var item in Model.Items)
            {
                <div class="ok-card ok-mb-4">
                    <div class="ok-card-body">
                        <div class="ok-flex ok-gap-4 ok-flex-wrap" style="align-items: flex-start;">
                            <!-- Book Cover -->
                            <div style="flex: 0 0 200px; max-width: 100%;">
                                @if (!string.IsNullOrWhiteSpace(item.CoverUrl) && !item.CoverUrl.Contains("book-placeholder.jpg", StringComparison.OrdinalIgnoreCase))
                                {
                                    <img src="@item.CoverUrl" 
                                         alt="@item.Title cover" 
                                         class="ok-book-cover" 
                                         style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px;" />
                                }
                                else
                                {
                                    <div class="ok-no-image ok-no-image-border" style="width: 100%; height: 300px; border-radius: 8px;">NO IMAGE</div>
                                }
                            </div>

                            <!-- Book Details -->
                            <div style="flex: 1; min-width: 300px;">
                                <h3 style="font-weight: 900; margin-bottom: 0.25rem; font-size: 1.75rem; color: var(--ok-title);">
                                    @item.Title
                                </h3>
                                <p style="font-weight: 700; opacity: 0.75; font-size: 1.1rem; margin-bottom: 1rem;">
                                    by @item.Author
                                </p>

                                <div class="ok-book-meta ok-mb-3">
                                    @if (!string.IsNullOrWhiteSpace(item.Category))
                                    {
                                        <span class="ok-badge ok-badge-accent">@item.Category</span>
                                    }

                                    @if (item.IsAvailable)
                                    {
                                        <span class="ok-badge ok-badge-success">Available</span>
                                    }
                                    else
                                    {
                                        <span class="ok-badge ok-badge-secondary">Reserved</span>
                                    }

                                    <span class="ok-rating">
                                        <i class="bi bi-star-fill"></i>
                                        @item.Rating.ToString("0.0")
                                    </span>
                                </div>

                                @if (!string.IsNullOrWhiteSpace(item.ISBN))
                                {
                                    <div class="ok-mb-3">
                                        <span class="ok-badge ok-badge-accent">ISBN</span>
                                        <span style="font-weight: 700; margin-left: 0.5rem; color: var(--ok-title);">
                                            @item.ISBN
                                        </span>
                                    </div>
                                }

                                <hr style="border: 0; border-top: 1px solid var(--ok-border); margin: 1rem 0;">

                                <!-- Action Section -->
                                <div class="ok-card ok-mt-3" style="box-shadow: var(--ok-shadow-sm); background: rgba(0,0,0,0.02);">
                                    <div class="ok-card-body">
                                        @if (item.Stock > 0)
                                        {
                                            <p style="font-weight: 700; color: var(--ok-text); margin-bottom: 0.75rem;">
                                                <i class="bi bi-check-circle-fill me-2" style="color: var(--ok-success);"></i>
                                                This book is currently available for borrowing. (@item.Stock in stock)
                                            </p>

                                            <div class="ok-flex ok-gap-2 ok-flex-wrap">
                                                <button class="btn-ok-primary"
                                                        onclick="OkToast.success('Borrow request sent', 'Request')">
                                                    <i class="bi bi-journal-check me-2"></i>
                                                    Borrow Book
                                                </button>

                                                <a class="btn-ok-secondary"
                                                   asp-controller="Books" asp-action="Details" asp-route-id="@item.Id">
                                                    <i class="bi bi-eye me-2"></i>
                                                    View Details
                                                </a>
                                            </div>
                                        }
                                        else
                                        {
                                            <p style="font-weight: 700; color: var(--ok-text); margin-bottom: 0.75rem;">
                                                <i class="bi bi-x-circle-fill me-2" style="color: var(--ok-secondary);"></i>
                                                This book is currently borrowed by another member.
                                            </p>

                                            <div class="ok-flex ok-gap-2 ok-flex-wrap">
                                                <button class="btn-ok-primary"
                                                        onclick="OkToast.info('You are added to the reservation list', 'Reserved')">
                                                    <i class="bi bi-clock-history me-2"></i>
                                                    Reserve
                                                </button>

                                                <button class="btn-ok-secondary"
                                                        onclick="OkToast.info('You will be notified when available', 'Notification')">
                                                    <i class="bi bi-bell me-2"></i>
                                                    Notify Me
                                                </button>

                                                <a class="btn-ok-secondary"
                                                   asp-controller="Books" asp-action="Details" asp-route-id="@item.Id">
                                                    <i class="bi bi-eye me-2"></i>
                                                    View Details
                                                </a>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
