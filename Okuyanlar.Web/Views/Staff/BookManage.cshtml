@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model IEnumerable<Okuyanlar.Core.Entities.Book>

@{
    ViewData["Title"] = "Manage Books";
}

<div class="ok-section" style="padding-top:2rem; padding-bottom:2rem;">
    <div class="container ok-container">
        <div class="ok-pagehead">
            <div>
                <h2 class="ok-pagehead-title">Manage Books</h2>
                <div class="ok-pagehead-sub">View, edit, and add inventory records.</div>
            </div>
            <div class="ok-pagehead-actions ok-flex ok-gap-2">
                <a class="btn-ok-secondary" asp-action="BookCreate">
                    <i class="bi bi-plus-circle me-2"></i>Add Book
                </a>
            </div>
        </div>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success ok-mt-3" role="alert" style="font-weight:800;">
                @TempData["SuccessMessage"]
            </div>
        }

        @if (Model == null || !Model.Any())
        {
            <div class="ok-card ok-mt-4" style="padding:2rem; text-align:center;">
                <i class="bi bi-inbox" style="font-size:3rem; color:var(--ok-accent); opacity:.5;"></i>
                <p class="ok-mt-2" style="font-weight:800; opacity:.8;">No books found.</p>
                <a class="btn-ok-primary ok-mt-2" asp-action="BookCreate">
                    <i class="bi bi-plus-circle me-2"></i>Add first book
                </a>
            </div>
        }
        else
        {
            <div class="ok-card ok-mt-4">
                <div class="ok-card-body" style="overflow-x:auto;">
                    <table class="table align-middle" style="min-width: 820px;">
                        <thead>
                            <tr>
                                <th style="width:120px;">Cover</th>
                                <th>Title</th>
                                <th>Author</th>
                                <th>ISBN</th>
                                <th>Stock</th>
                                <th>Status</th>
                                <th style="width:140px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var b in Model)
                            {
                                var coverUrl = b.CoverUrl;
                                <tr>
                                    <td>
                                        @if (!string.IsNullOrWhiteSpace(coverUrl) && !coverUrl.Contains("book-placeholder.jpg", StringComparison.OrdinalIgnoreCase))
                                        {
                                            <img src="@coverUrl" alt="@b.Title cover" style="width:70px; height:90px; object-fit:cover; border-radius:6px;" />
                                        }
                                        else
                                        {
                                            <div class="ok-no-image ok-no-image-border" style="width:70px; height:90px; border-radius:6px; font-size:.6rem;">NO IMAGE</div>
                                        }
                                    </td>
                                    <td style="font-weight:800;">@b.Title</td>
                                    <td>@b.Author</td>
                                    <td>@b.ISBN</td>
                                    <td>@b.Stock</td>
                                    <td>
                                        @if (b.IsActive && b.Stock > 0)
                                        {
                                            <span class="ok-badge ok-badge-success">Active</span>
                                        }
                                        else if (b.IsActive)
                                        {
                                            <span class="ok-badge ok-badge-warning">Active / Out</span>
                                        }
                                        else
                                        {
                                            <span class="ok-badge ok-badge-secondary">Inactive</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="ok-flex ok-gap-2 ok-flex-wrap">
                                            <a class="btn-ok-secondary btn-sm" asp-action="BookEdit" asp-route-id="@b.Id">
                                                <i class="bi bi-pencil-square me-1"></i>Edit
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
    </div>
</div>
