@using System.Linq
@model IEnumerable<Okuyanlar.Core.Entities.Book>

@{
    ViewData["Title"] = "Home";
}

<div class="ok-section" style="background:#fef1dc; padding: 4rem 0;">
    <div class="container ok-container">
        <div class="text-center mb-5">
            <h1 style="font-size: 3rem; font-weight: 900; margin-bottom: 1rem;">
                Welcome to <span style="color: var(--ok-accent);">Okuyanlar</span>
            </h1>
            <p style="font-size: 1.25rem; color: var(--ok-text); opacity: 0.9; max-width: 600px; margin: 0 auto;">
                Discover books, manage lending, and keep everything organized â€” calmly.
            </p>

            <div class="ok-flex ok-gap-2 ok-justify-center mt-4 ok-flex-wrap">
                <!-- Keep link even if Catalog controller is missing; a click would 404 but it will compile. -->
                <a asp-controller="Catalog" asp-action="Index" class="btn-ok-primary" style="padding: 1rem 2rem;">
                    <i class="bi bi-search me-2"></i> Browse Catalog
                </a>

                @if (User.Identity?.IsAuthenticated == false)
                {
                    <a asp-controller="Account" asp-action="Login" class="btn-ok-accent" style="padding: 1rem 2rem;">
                        <i class="bi bi-box-arrow-in-right me-2"></i> Login
                    </a>
                }
            </div>
        </div>
    </div>
</div>

<div class="ok-section">
    <div class="container ok-container">
        <div class="ok-flex ok-items-center ok-justify-between mb-4">
            <h2 style="font-weight: 800; margin:0;">
                <i class="bi bi-fire me-2" style="color: var(--ok-accent);"></i>
                Popular This Month
            </h2>
        </div>

        @if (Model != null && Model.Any())
        {
            <div class="ok-grid ok-grid-4">
                @foreach (var book in Model.Take(8))
                {
                    var coverUrl = book.CoverUrl;

                    <div class="ok-book-card">
                        @if (!string.IsNullOrWhiteSpace(coverUrl) && !coverUrl.Contains("book-placeholder.jpg", StringComparison.OrdinalIgnoreCase))
                        {
                            <img src="@coverUrl"
                                 alt="@book.Title cover"
                                 class="ok-book-cover" />
                        }
                        else
                        {
                            <div class="ok-no-image" style="width:100%; height:280px;">NO IMAGE</div>
                        }

                        <div class="ok-book-body">
                            <div class="ok-book-title">@book.Title</div>
                            <div class="ok-book-author">by @book.Author</div>

                            <div class="ok-book-meta">
                                @if (book.Stock > 0)
                                {
                                    <span class="ok-badge ok-badge-success">
                                        <i class="bi bi-check-circle me-1"></i> Available
                                    </span>
                                }
                                else
                                {
                                    <span class="ok-badge ok-badge-secondary">
                                        <i class="bi bi-x-circle me-1"></i> Out of Stock
                                    </span>
                                }
                            </div>

                            <a class="btn-ok-secondary ok-mt-3 ok-text-center" style="display:block;"
                               asp-controller="Books" asp-action="Details" asp-route-id="@book.Id">
                                View Details
                            </a>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="ok-card" style="padding: 3rem; text-align:center;">
                <i class="bi bi-inbox" style="font-size: 4rem; color: var(--ok-accent); opacity: 0.5;"></i>
                <p class="ok-mt-3" style="margin:0; font-weight:700; opacity:.8;">
                    No books available at the moment. Check back soon!
                </p>
            </div>
        }
    </div>
</div>
