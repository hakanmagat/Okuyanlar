@using System.Linq
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model IEnumerable<Okuyanlar.Core.Entities.Book>

@{
    ViewData["Title"] = "Books";
}

<div class="ok-section">
    <div class="container ok-container">

        <!-- Page Header -->
        <div class="ok-flex ok-items-center ok-justify-between ok-mb-4 ok-flex-wrap ok-gap-2">
            <h1 style="font-weight:900;">
                <i class="bi bi-bookshelf me-2" style="color:var(--ok-accent);"></i>
                Library Catalog
            </h1>

            <div class="ok-flex ok-gap-2">
                <span class="ok-badge ok-badge-accent">
                    @Model?.Count() ?? 0 Books
                </span>
                <a asp-controller="Books" asp-action="Top10" class="ok-badge ok-badge-warning" style="text-decoration: none; cursor: pointer;">
                    <i class="bi bi-star-fill me-1"></i>Top 10
                </a>
            </div>
        </div>

        @if (Model != null && Model.Any())
        {
            <div class="ok-grid ok-grid-4">
                @foreach (var book in Model)
                {
                    var coverUrl = book.CoverUrl;

                    <div class="ok-book-card">
                        @if (!string.IsNullOrWhiteSpace(coverUrl) && !coverUrl.Contains("book-placeholder.jpg", StringComparison.OrdinalIgnoreCase))
                        {
                            <img src="@coverUrl"
                                 alt="@book.Title cover"
                                 class="ok-book-cover" />
                        }
                        else
                        {
                            <div class="ok-no-image" style="width:100%; height:280px;">NO IMAGE</div>
                        }

                        <div class="ok-book-body">
                            <div class="ok-book-title">@book.Title</div>
                            <div class="ok-book-author">by @book.Author</div>

                            <!-- Rating Display -->
                            @if (book.Rating > 0)
                            {
                                <div class="ok-flex ok-items-center ok-gap-1" style="margin-bottom: 8px;">
                                    @for (int i = 0; i < 5; i++)
                                    {
                                        if (i < Math.Floor(book.Rating))
                                        {
                                            <i class="bi bi-star-fill" style="color: #ffc107; font-size: 12px;"></i>
                                        }
                                        else if (i < book.Rating)
                                        {
                                            <i class="bi bi-star-half" style="color: #ffc107; font-size: 12px;"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-star" style="color: #ccc; font-size: 12px;"></i>
                                        }
                                    }
                                    <span style="font-size: 12px; font-weight: 600; margin-left: 4px;">@book.Rating.ToString("F1")</span>
                                </div>
                            }

                            <div class="ok-book-meta">
                                @if (book.Stock > 0)
                                {
                                    <span class="ok-badge ok-badge-success">Available</span>
                                }
                                else
                                {
                                    <span class="ok-badge ok-badge-secondary">Unavailable</span>
                                }
                            </div>

                            <a asp-controller="Books"
                               asp-action="Details"
                               asp-route-id="@book.Id"
                               class="btn-ok-secondary ok-mt-3"
                               style="display:block; text-align:center;">
                                View Details
                            </a>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="ok-card text-center" style="padding:3rem;">
                <i class="bi bi-inbox" style="font-size:3rem; color:var(--ok-accent); opacity:.5;"></i>
                <p class="ok-mt-2" style="font-weight:800; opacity:.8;">
                    No books found.
                </p>
            </div>
        }
    </div>
</div>
